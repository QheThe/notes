# cpu 中断
## 中断
- #### 中断定义
    - 指 cpu 对突发的外部事件的反应过程或机制
    - cpu 收到**外部信号**（中断信号）后，停止当前工作，转去处理该**外部事件**，处理完毕后回到原来工作的**中断处**（断点）继续原来的工作

- #### 引入中断的目的
    - 实现并发活动
    - 实现实时处理
    - 故障自动处理

## 中断相关概念
- #### 中断源和中断类型
    - 引起系统中断的事件称为中断源
    - 中断类型
        1. 强迫中断 和 自愿中断
            - 强迫中断：程序没有预期：例如：i/o、外部中断
            - 自愿中断：程序有预期。例如：执行访管指令

        2. 外中断（中断） 和 内部中断（俘获）
            - 外中断：由 cpu 外部事件引起。例如：i/o，外设事件触发
            - 内中断：由 cpu 内部事件引起。例如：访管中断、程序中断
        
        3. 外中断：不可屏蔽中断 和 可屏蔽中断
            - 不可屏蔽中断：中断的原因很紧要，cpu 必须响应
            - 可屏蔽中断：中断原因不是很紧要，cpu 可以不响应

- #### 断点
    - 程序中断的地方，将要执行的下一指令的地址
    - CS:IP

- #### 现场（上下文）
    - 相关寄存器

- #### 现场的两个处理过程
    - 现场的保护：进入**中断服务程序**之前，**栈**
    - 现场的恢复：退出**中断服务程序**之后，**栈**

- #### 中断响应过程
    1. 识别中断源
    2. 保护断点和现场
    3. 装入**中断服务程序**的入口地址（CS：IP）
    4. 进入中断服务程序
    5. 回复现场和断点
    6. 中断返回：（IRET）—— 返回到原来的程序

- #### 中断响应的实质
    - 实质
        - 交换指令执行地址
        - 交换 cpu 的态 （核态 -》 用户态）

    - 工作
        - 现场保护和恢复
        - 参数传递（通信）